### Проверка значения `gas_ppm = 2.449188471`

1. **Расчёт ppm:**
   - В коде используется формула: `ppm = 1000.0 * pow(Rs/R0, -2.6)` (примерная кривая для CH4 из datasheet MQ-4).
   - `gas_raw = 69`:
     - `Vout = (69 / 1023.0) * 3.3 ≈ 0.222V` (напряжение на A0).
     - `Rs = ((5.0 * 10.0) / 0.222) - 10.0 ≈ 215.22 kΩ` (сопротивление датчика).
     - При калибровке (в чистом воздухе) `R0` было рассчитано как базовое сопротивление. Допустим, `R0 ≈ 45 kΩ` (пример из прошлого лога).
     - `ratio = Rs / R0 = 215.22 / 45 ≈ 4.78`.
     - `ppm = 1000 * (4.78)^(-2.6) ≈ 2.45`.

2. **Правильность значения:**
     - **Калибровка:** `R0` могло быть рассчитано некорректно (например, воздух не был чистым при калибровке). Можно попробовать перекалибровать в чистом воздухе (вызов `mqInstance->calibrate()` вручную).
     - **Формула:** Упрощённая формула `1000 * (Rs/R0)^(-2.6)` — это аппроксимация. Реальная кривая для MQ-4 сложнее и зависит от типа газа (CH4, дым и т.д.).
     - **Диапазон:** Из-за обрезки 3.3V мы видим только часть сигнала, что может искажать расчёты.

3. **Вывод:**
   - Значение `2.45 ppm` логично для чистого воздуха с текущей калибровкой, но для точности нужно:
     - Перепроверить `R0` в чистом воздухе.
     - Проверить датчик с небольшим количеством газа (например, зажигалкой на расстоянии) и посмотреть, как растёт ppm.

Если калибровка не критична, можно оставить как есть — сырые значения (`gas_raw`) всё равно дают представление о состоянии.

---

### Напряжение: 5V vs 3.3V и защита платы
1. **Опасность >3.3V на A0:**
   - Аналоговый вход A0 на ESP8266 рассчитан на **0–3.3V**. Если на него попадёт больше (например, 5V с MQ-4), это может повредить АЦП или всю плату. У ESP8266 нет встроенной защиты от перенапряжения на A0, так что риск есть, особенно если датчик выдаст высокий сигнал (при сильном газе).

2. **Вариант 1: Делитель напряжения**
   - Чтобы масштабировать 0–5V с MQ-4 в 0–3.3V для A0, нужен делитель напряжения.
   - Формула: `Vout = Vin * (R2 / (R1 + R2))`.
     - `Vin = 5V` (макс. выход MQ-4).
     - `Vout = 3.3V` (макс. для A0).
     - Выбираем: `R1 = 2kΩ`, `R2 = 3.3kΩ`.
     - Проверка: `Vout = 5 * (3.3 / (2 + 3.3)) ≈ 3.11V` (достаточно близко к 3.3V, безопасно).
   - **Схема:**
     - AOUT MQ-4 → R1 (2kΩ) → A0 → R2 (3.3kΩ) → GND.
   - **Комментарий для кода или README:**
     ```cpp
     // Note: MQ-4 powered at 5V. Use a voltage divider (R1=2kΩ, R2=3.3kΩ) between AOUT and A0
     // to scale 0-5V to 0-3.3V for ESP8266 ADC safety.
     ```

3. **Вариант 2: Питание MQ-4 от 3.3V**
   - MQ-4 работает на 2.5–5.5V, так что 3.3V с выхода платы (3V3) подойдёт.
   - Плюсы:
     - AOUT будет в пределах 0–3.3V, что безопасно для A0 без резисторов.
     - Полный диапазон АЦП используется без потерь.
   - Минусы:
     - Нагревательный элемент может работать чуть хуже (рекомендуют 5V для стабильности).
     - Чувствительность может снизиться (нужно проверить datasheet или протестировать).
   - **Тест:** Подключить VCC MQ-4 к 3V3 вместо 5V, перекалибровать и посмотреть на `gas_raw` и `gas_ppm`.

4. **Питание платы:**
   - Плата (например, NodeMCU) через Micro USB принимает 5V, преобразует в 3.3V через стабилизатор и питает ESP8266. Ей хватит 5V от блока питания.
   - Подавать 3.3V напрямую на VIN или USB нельзя — стабилизатору нужно >3.3V для работы (обычно минимум 4.5V).


---

### Обновление кода (для делителя)
Если добавить делитель, необходимо скорректировать расчёты в `S_MQ`:

#### S_MQ.cpp (S_MQ::calculatePPM)
```cpp
float S_MQ::calculatePPM(int rawValue) {
    if (R0 == 0.0) return 0.0;
    // С делителем 2kΩ и 3.3kΩ: масштабируем обратно к 5V
    float Vout = (rawValue / 1023.0) * 3.3 * (5.3 / 3.3); // Учитываем делитель (R1+R2)/R2
    float Rs = ((5.0 * 10.0) / Vout) - 10.0;
    float ratio = Rs / R0;
    float ppm = 1000.0 * pow(ratio, -2.6);
    return ppm;
}
```
